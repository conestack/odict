# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Repository Overview

**odict** is a standalone Python package providing ordered dictionary implementations. See [README.md](README.md) for package overview, features, and usage examples.

This is a **single package repository** (not part of the larger Conestack monorepo structure):

```
odict/
├── src/odict/
│   ├── __init__.py       # Main module exports
│   ├── odict.py          # Pure Python implementation (_odict, odict)
│   └── bench.py          # Benchmarking suite with argparse
├── tests/
│   └── test_*.py         # Test suite
├── docs/                 # Sphinx documentation
├── pyproject.toml        # Package configuration (hatchling)
├── mx.ini                # mxdev/mxmake configuration
└── Makefile              # Generated by mxmake
```

## Common Commands

### Setup and Installation

```bash
# Full install (creates venv, installs dependencies)
make install

# Or step-by-step:
make mxenv        # Create virtual environment at ./venv
make mxfiles      # Generate requirements files
make packages     # Install package in editable mode
```

### Testing

```bash
# Run all tests
make test

# Run coverage (requires 100% coverage)
make coverage

# Run single test
venv/bin/pytest tests/test_odict.py::TestOdict::test_init_with_items
```

### Code Quality

```bash
# Check code style with ruff
make ruff-check

# Auto-format code with ruff
make ruff-format

# Combined check and format
make check format
```

### Cleanup

```bash
# Clean build artifacts (keeps venv and sources)
make clean

# Remove venv
make mxenv-clean

# Clean Python bytecode and caches
make runtime-clean
```

## Core Architecture

See [README.md](README.md) for architecture overview and [docs/source/technical/architecture.md](docs/source/technical/architecture.md) for detailed technical documentation.

### Key Implementation Classes

1. **`_base_odict`** (abstract base class in `odict.py`)
   - Core ordered dict logic
   - Subclasses must implement `_dict_cls()` (returns dict class)
   - Subclasses must implement `_entry_cls()` (returns list class for internal [prev, value, next] storage)

2. **`odict`** (pure Python in `odict.py`)
   - Inherits from `_base_odict` and `dict`
   - Uses standard `dict` and `list`

### Backward Compatibility

- `_dict_impl()` → now `_dict_cls()` (deprecated method still works with warning)
- `_list_factory()` → now `_entry_cls()` (deprecated method still works with warning)

## Build System

Uses **mxmake** with **mxdev**:

- Virtual environment uses **uv** as package installer (faster than pip)
- Minimum Python: **3.10** (configured in Makefile)
- Supports Python: **3.10-3.14** (see pyproject.toml)
- Test framework: **pytest** (configured via `TEST_COMMAND` in Makefile)
- Coverage enforces **100% coverage** of `src/odict` (excluding `bench.py`)

## Testing Notes

- Tests use **pytest** with parametrized fixtures
- Fixtures in `tests/conftest.py` provide: `ODict`, `AbstractODict`, `nil`, `empty_od`, `sample_od`, `five_items_od`
- Coverage target: **100%** of `src/odict` (excluding `bench.py`)
- Test files: `tests/test_*.py`

## Benchmarking

The benchmarking suite has been refactored with argparse support:

```bash
# Comprehensive benchmarks
venv/bin/python -m odict.bench --mode comprehensive

# Micro-benchmarks only
venv/bin/python -m odict.bench --mode micro

# Custom configuration
venv/bin/python -m odict.bench --sizes "100,1000,10000" --baseline fastest --micro-iterations 10000
```

See `src/odict/bench.py` for implementation details.
